jQuery(document).ready(function(e){function t(t){e(".epkb-panel-container .epkb-tab-panel:nth-child("+(t+1)+")").addClass("active")}function a(e,t){var a=window.location.href;a=function(e,t,a){var i=new RegExp("([?&])"+t+"=.*?(&|$)","i"),n=-1!==e.indexOf("?")?"&":"?";return e.match(i)?e.replace(i,"$1"+t+"="+a+"$2"):e+n+t+"="+a}(a,"top-category",t),window.history.pushState({tab:e},"title",a)}function i(e,t,a){if("show"===e){let e='<div class="epkb-admin-dialog-box-loading"><div class="epkb-admin-dbl__header"><div class="epkb-admin-dbl-icon epkbfa epkbfa-hourglass-half"></div>'+(t?'<div class="epkb-admin-text">'+t+"</div>":"")+'</div></div><div class="epkb-admin-dialog-box-overlay"></div>';a.append(e)}else"remove"===e&&(a.find(".epkb-admin-dialog-box-loading").remove(),a.find(".epkb-admin-dialog-box-overlay").remove())}var n=e("#epkb-main-page-container"),o=e("#epkb-content-container"),l=e(".epkb-nav-tabs li"),s=e(".epkb-tab-panel"),c=e("#eckb-article-content-body"),r=e(".eckb-article-toc");if(e("body").on("submit","#epkb_search_form",function(t){if(t.preventDefault(),""!==e("#epkb_search_terms").val()){var a={action:"epkb-search-kb",epkb_kb_id:e("#epkb_kb_id").val(),search_words:e("#epkb_search_terms").val(),is_kb_main_page:e(".eckb_search_on_main_page").length},i="";e.ajax({type:"GET",dataType:"json",data:a,url:epkb_vars.ajaxurl,beforeSend:function(t){e(".loading-spinner").css("display","block"),e("#epkb-ajax-in-progress").show()}}).done(function(t){t=t||"",e(".loading-spinner").css("display","none"),i=t.error||"success"!==t.status?epkb_vars.msg_try_again:t.search_result}).fail(function(e,t,a){i=epkb_vars.msg_try_again+". ["+(a||epkb_vars.unknown_error)+"]"}).always(function(){e("#epkb-ajax-in-progress").hide(),i&&(e("#epkb_search_results").css("display","block"),e("#epkb_search_results").html(i))})}}),e("#epkb_search_terms").on("keyup",function(){this.value||e("#epkb_search_results").css("display","none")}),o.length&&l.length){let t=0;o.find(l).each(function(){let a=e(this).outerHeight(!0);a>t&&(t=a)}),o.find(l).css("min-height",t)}window.onpopstate=function(t){t.state&&-1!==t.state.tab.indexOf("epkb_tab_")?(o.find(".epkb_top_panel").removeClass("active"),e("#main-category-selection").length>0?e("#main-category-selection").val(o.find("#"+t.state.tab).val()):(o.find(".epkb_top_categories").removeClass("active"),o.find("#"+t.state.tab).addClass("active")),o.find("."+t.state.tab).addClass("active")):e("#epkb_tab_1").length>0&&!o.find("#epkb_tab_1").hasClass("active")&&(o.find(".epkb_top_panel").removeClass("active"),e("#main-category-selection").length>0?e("#main-category-selection").val(o.find("#epkb_tab_1").val()):(o.find(".epkb_top_categories").removeClass("active"),o.find("#epkb_tab_1").addClass("active")),o.find(".epkb_tab_1").addClass("active"))},o.find(l).each(function(){e(this).on("click",function(){o.find(l).removeClass("active"),e(this).addClass("active"),o.find(s).removeClass("active"),t(e(this).index()),a(e(this).attr("id"),e(this).data("cat-name"))})}),e("#main-category-selection").on("change",function(){o.find(s).removeClass("active"),e("#main-category-selection option:selected").each(function(){t(e(this).index()),a(e(this).attr("id"),e(this).data("cat-name"))})}),e(".epkb-section-body .epkb-category-level-2-3").each(function(){e(this).on("click",function(){e(this).parent().children("ul").toggleClass("active");switch(e(this).attr("aria-expanded")){case"true":e(this).attr("aria-expanded","false");break;case"false":e(this).attr("aria-expanded","true")}})}),o.find(".epkb-section-body .epkb-category-level-2-3").each(function(){if(!e(this).hasClass("epkb-category-focused")){var t=e(this).find(".epkb-category-level-2-3__cat-icon");e(this).on("click",function(){function e(e){t.hasClass(e[0])?(t.removeClass(e[0]),t.addClass(e[1])):t.hasClass(e[1])&&(t.removeClass(e[1]),t.addClass(e[0]))}e(["ep_font_icon_plus","ep_font_icon_minus"]),e(["ep_font_icon_plus_box","ep_font_icon_minus_box"]),e(["ep_font_icon_right_arrow","ep_font_icon_down_arrow"]),e(["ep_font_icon_arrow_carrot_right","ep_font_icon_arrow_carrot_down"]),e(["ep_font_icon_arrow_carrot_right_circle","ep_font_icon_arrow_carrot_down_circle"]),e(["ep_font_icon_folder_add","ep_font_icon_folder_open"])})}}),n.find(".epkb-show-all-articles").on("click",function(){e(this).toggleClass("active");var t=e(this).parent("ul").find("li");e(this).hasClass("active")?(e(this).find(".epkb-show-text").addClass("epkb-hide-elem"),e(this).find(".epkb-hide-text").removeClass("epkb-hide-elem"),e(this).attr("aria-expanded","true")):(e(this).find(".epkb-show-text").removeClass("epkb-hide-elem"),e(this).find(".epkb-hide-text").addClass("epkb-hide-elem"),e(this).attr("aria-expanded","false")),e(t).each(function(){e(this).hasClass("epkb-hide-elem")?(e(this).removeClass("epkb-hide-elem"),e(this).addClass("visible")):e(this).hasClass("visible")&&(e(this).removeClass("visible"),e(this).addClass("epkb-hide-elem"))})});let d=e("#epkb-search-kb").text();e("#epkb-search-kb").text(d),e("body").on("click",".eckb-print-button-container, .eckb-print-button-meta-container",function(t){e("body").hasClass("epkb-editor-preview")||(e("#eckb-article-content").parents().each(function(){e(this).siblings().addClass("eckb-print-hidden")}),window.print())});let _={firstLevel:1,lastLevel:6,searchStr:"",currentId:"",offset:50,excludeClass:!1,init:function(){this.getOptions();let t=this.getArticleHeaders();if(t.length>0)r.html(this.getToCHTML(t)),e("#eckb-article-content .eckb-article-toc").length>0&&e("#eckb-article-content .eckb-article-toc").html(this.getToCHTML(t,"h2")),e(" .eckb-article-toc--position-middle").length>0?r.css("display","inline-block"):r.fadeIn();else if(r.hide(),e("body").hasClass("epkb-editor-preview")){r.show();let e=`\n\t\t\t\t\t\t<div class="eckb-article-toc__inner">\n\t\t\t\t\t\t\t<h4 class="eckb-article-toc__title">${r.find(".eckb-article-toc__title").html()}</h4>\n\t\t\t\t\t\t\t<nav class="eckb-article-toc-outline" role="navigation" aria-label="Article outline">\n\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t<li>${epkb_vars.toc_editor_msg}</li>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t</nav>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\t\n\t\t\t\t\t\t`;r.html(e)}let a=this;if(e(".eckb-article-toc__level a").on("click",function(t){if(e(".epkb-editor-preview").length)return void t.preventDefault();let i=e(this).data("target");if(!i||0==e("[data-id="+i+"]").length)return!1;e("body, html").scrollTop();let n=e("[data-id="+i+"]").offset().top-a.offset,o=parseInt(e(this).closest(".eckb-article-toc").data("speed"));return e("body, html").animate({scrollTop:n},o),!1}),e(window).on("scroll",this.scrollSpy),this.scrollSpy(),!location.hash)return;let i=e("[data-target="+location.hash.slice(1)+"]");i.length&&i.trigger("click")},getOptions:function(){for(r.data("min")&&(this.firstLevel=r.data("min")),r.data("max")&&(this.lastLevel=r.data("max")),r.data("offset")?this.offset=r.data("offset"):r.data("offset",this.offset),void 0!==r.data("exclude_class")&&(this.excludeClass=r.data("exclude_class"));this.firstLevel<=this.lastLevel;)this.searchStr+="h"+this.firstLevel+(this.firstLevel<this.lastLevel?",":""),this.firstLevel++},getArticleHeaders:function(){let t=[],a=this;if(c.find(a.searchStr).each(function(){if(0==e(this).text().length)return;if(a.excludeClass&&e(this).hasClass(a.excludeClass))return;let i,n={};e(this).data("id")?i=e(this).data("id"):(i="articleTOC_"+t.length,e(this).attr("data-id",i)),n.id=i,n.title=e(this).text(),"H1"==e(this).prop("tagName")?n.level=1:"H2"==e(this).prop("tagName")?n.level=2:"H3"==e(this).prop("tagName")?n.level=3:"H4"==e(this).prop("tagName")?n.level=4:"H5"==e(this).prop("tagName")?n.level=5:"H6"==e(this).prop("tagName")&&(n.level=6),t.push(n)}),0==t.length)return t;let i=1,n=6;t.forEach(function(e){e.level>i&&(i=e.level),e.level<n&&(n=e.level)}),n>1&&t.forEach(function(e,a){t[a].level=e.level-n+1});let o=1;for(;o<i;){let e=!1;t.forEach(function(t){t.level==o&&(e=!0)}),e?o++:t.forEach(function(e,a){e.level>o&&(t[a].level=e.level-1)}),o++}return t},getToCHTML:function(e,t="h4"){let a;if(r.find(".eckb-article-toc__title").length){let e=r.find(".eckb-article-toc__title").html();a=`\n\t\t\t\t\t<div class="eckb-article-toc__inner">\n\t\t\t\t\t\t<${t} class="eckb-article-toc__title">${e}</${t}>\n\t\t\t\t\t\t<nav class="eckb-article-toc-outline" role="navigation" aria-label="Article outline">\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t`}else a='\n\t\t\t\t\t<div class="eckb-article-toc__inner">\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t';return e.forEach(function(e){let t=new URL(location.href);t.hash=e.id,t=t.toString(),a+=`<li class="eckb-article-toc__level eckb-article-toc__level-${e.level}"><a href="${t}" aria-label="Scrolls down the page to this heading" data-target="${e.id}">${e.title}</a></li>`}),a+="\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t</nav>\n\t\t\t\t\t</div>\n\t\t\t\t"},scrollSpy:function(){let t=e(window).scrollTop(),a=e(window).scrollTop()+e(window).height(),i=!1,n=!1,o=r.data("offset");if(a==e(document).height()?(i=!0,n=e(".eckb-article-toc__level a").last(),e(".eckb-article-toc__level a").removeClass("active"),n.addClass("active")):e(".eckb-article-toc__level a").each(function(l){if(e(this).removeClass("active"),i)return!0;let s=e(this).data("target");if(!s||0==e("[data-id="+s+"]").length)return!0;let c=e("[data-id="+s+"]"),r=c.offset().top,d=c.offset().top+c.height();if(l+1==e(".eckb-article-toc__level a").length)d=c.parent().offset().top+c.parent().height();else{let t=e(".eckb-article-toc__level a").eq(l+1).data("target");t&&e("[data-id="+t+"]").length&&(d=e("[data-id="+t+"]").offset().top)}d-=o+1;let _=!1;(r-=o)<a&&r>t?_=!0:d<a&&d>t?_=!0:r<t&&d>a&&(_=!0),_&&(e(this).addClass("active"),i=!0,n=e(this))}),!n||0==n.length||!i)return;let l=n.position().top;(l<0||l>n.closest(".eckb-article-toc__inner").height())&&n.closest(".eckb-article-toc__inner").scrollTop(l-n.closest(".eckb-article-toc__inner").find(".eckb-article-toc__title").position().top)}};if(setTimeout(function(){r.length&&_.init();let t=e("#eckb-article-content-body").position(),a=e(window).width(),i=void 0===e("#eckb-article-page-container-v2").data("mobile_breakpoint")?768:e("#eckb-article-page-container-v2").data("mobile_breakpoint");e(".eckb-article-page--L-sidebar-to-content").length>0&&a>i&&e("#eckb-article-page-container-v2").find("#eckb-article-left-sidebar ").css("margin-top",t.top+"px"),e(".eckb-article-page--R-sidebar-to-content").length>0&&a>i&&e("#eckb-article-page-container-v2").find("#eckb-article-right-sidebar ").css("margin-top",t.top+"px"),r.length&&(e(window).width()>(void 0===e("#eckb-article-page-container-v2").data("mobile_breakpoint")?111:e("#eckb-article-page-container-v2").data("mobile_breakpoint"))||e("#eckb-article-content-header-v2 .eckb-article-toc").length||(e("#eckb-article-left-sidebar .eckb-article-toc").length?e("#eckb-article-content-header-v2").append(e("#eckb-article-left-sidebar .eckb-article-toc")):e("#eckb-article-right-sidebar .eckb-article-toc").length&&e("#eckb-article-content-header-v2").append(e("#eckb-article-right-sidebar .eckb-article-toc"))))},500),e(document).on("click","#eckb-kb-create-demo-data",function(t){if(t.preventDefault(),e(this).closest(".epkb-editor-preview").length)return;let a={action:"epkb_create_kb_demo_data",epkb_kb_id:e(this).data("id"),_wpnonce_epkb_ajax_action:epkb_vars.nonce},n=e(this).closest(".eckb-kb-no-content"),o=e(".eckb-kb-no-content").find("#epkb-created-kb-content");e.ajax({type:"POST",dataType:"json",data:a,url:epkb_vars.ajaxurl,beforeSend:function(e){i("show","",n)}}).done(function(e){void 0!==(e=e||"").message&&o.addClass("epkb-dialog-box-form--active")}).fail(function(e,t,a){o.addClass("epkb-dialog-box-form--active").find(".epkb-dbf__body").html(a)}).always(function(){i("remove","",n)})}),e(document).on("click",".eckb-kb-no-content #epkb-created-kb-content .epkb-dbf__footer__accept__btn",function(){location.reload()}),0==e("#elay-sidebar-container-v2").length&&e("#epkb-sidebar-container-v2").length>0){function b(e,t){var a=["ep_font_icon_plus","ep_font_icon_plus_box","ep_font_icon_right_arrow","ep_font_icon_arrow_carrot_right","ep_font_icon_arrow_carrot_right_circle","ep_font_icon_folder_add"],i=["ep_font_icon_minus","ep_font_icon_minus_box","ep_font_icon_down_arrow","ep_font_icon_arrow_carrot_down","ep_font_icon_arrow_carrot_down_circle","ep_font_icon_folder_open"],n=a.indexOf(t),o=i.indexOf(t);n>=0?(e.removeClass(a[n]),e.addClass(i[n])):o>=0&&(e.removeClass(i[o]),e.addClass(a[o]))}var p=e("#epkb-sidebar-container-v2");p.on("click",".epkb-top-class-collapse-on",function(t){void 0!==t.originalEvent&&(e(t.originalEvent.target).hasClass("epkb-editor-zone__tab--active")||e(t.originalEvent.target).hasClass("epkb-editor-zone__tab--parent"))||(e(this).parent().toggleClass("epkb-active-top-category"),e(this).parent().find(e(".epkb-sidebar__cat__top-cat__body-container")).slideToggle())}),p.on("click",".epkb-sidebar__cat__top-cat__heading-container",function(t){if(void 0===t.originalEvent||!e(t.originalEvent.target).hasClass("epkb-editor-zone__tab--active")&&!e(t.originalEvent.target).hasClass("epkb-editor-zone__tab--parent")){var a=e(this).find(".epkb-sidebar__heading__inner span");a.length>0&&b(a,a.attr("class").match(/\ep_font_icon_\S+/g)[0])}}),p.on("click",".epkb-category-level-2-3",function(){e(this).next().slideToggle(),e(this).next().next().slideToggle()}),p.on("click",".epkb-category-level-2-3",function(){var t=e(this).find("span");t.length>0&&b(t,t.attr("class").match(/\ep_font_icon_\S+/g)[0])}),p.on("click",".epkb-show-all-articles",function(){e(this).toggleClass("active");var t=e(this).parent("ul").find("li");e(this).hasClass("active")?(e(this).find(".epkb-show-text").addClass("epkb-hide-elem"),e(this).find(".epkb-hide-text").removeClass("epkb-hide-elem"),e(this).attr("aria-expanded","true")):(e(this).find(".epkb-show-text").removeClass("epkb-hide-elem"),e(this).find(".epkb-hide-text").addClass("epkb-hide-elem"),e(this).attr("aria-expanded","false")),e(t).each(function(){e(this).hasClass("epkb-hide-elem")?(e(this).removeClass("epkb-hide-elem"),e(this).addClass("visible")):e(this).hasClass("visible")&&(e(this).removeClass("visible"),e(this).addClass("epkb-hide-elem"))})}),function(){let t=e("#eckb-article-content");if(void 0===t.data("article-id"))return;let a=t.data("article-id");if(void 0!==t.data("kb_article_seq_no")&&t.data("kb_article_seq_no")>0){let i=a+"_"+t.data("kb_article_seq_no");a=e("#sidebar_link_"+i).length>0?i:a}e(".epkb-sidebar__cat__top-cat li").removeClass("active"),e(".epkb-category-level-1").removeClass("active"),e(".epkb-category-level-2-3").removeClass("active"),e(".epkb-sidebar__cat__top-cat__heading-container").removeClass("active");let i=e("#sidebar_link_"+a);i.addClass("active"),i.parents(".epkb-sub-sub-category, .epkb-articles").each(function(){let t=e(this).parent().children(".epkb-category-level-2-3");if(!t.length)return!0;if(!t.hasClass("epkb-category-level-2-3"))return!0;t.next().show(),t.next().next().show();let a=t.find(".epkb_sidebar_expand_category_icon");a.length>0&&b(a,a.attr("class").match(/\ep_font_icon_\S+/g)[0])}),i.closest(".epkb-sidebar__cat__top-cat").parent().toggleClass("epkb-active-top-category"),i.closest(".epkb-sidebar__cat__top-cat").find(e(".epkb-sidebar__cat__top-cat__body-container")).show();let n=i.closest(".epkb-sidebar__cat__top-cat").find(".epkb-sidebar__cat__top-cat__heading-container .epkb-sidebar__heading__inner span");n.length>0&&b(n,n.attr("class").match(/\ep_font_icon_\S+/g)[0])}()}});